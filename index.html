<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DejandoHuella Trader ‚Äî Se√±ales en Vivo</title>
  <meta name="description" content="Panel p√∫blico de DejandoHuella Trader: historial y operaci√≥n en vivo desde MT4." />
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="img/logo.png" />

  <!-- ====== ESTILOS ====== -->
  <style>
    /* ==== PALETA ==== */
    :root{
      --bg:#0c0f17;
      --card:#121826;
      --line:#20293f;
      --muted:#97a2b3;
      --text:#e8eefc;
      --accent:#5ce1a9;
      --accent-2:#42c6ff;
      --ok:#2ed573;
      --warn:#ffd166;
      --err:#ff6b6b;
      --shadow:0 6px 16px rgba(0,0,0,.35);
    }

    /* ==== RESETEO / BASE ==== */
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans",sans-serif;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    a{color:var(--accent);text-decoration:none}
    .wrap{max-width:1000px;margin:0 auto;padding:20px 14px 60px}

    /* ==== TOP ALERT ==== */
    .topbar{
      position:sticky;top:0;z-index:50;
      background:#0d1423; border-bottom:1px solid var(--line);
      padding:6px 12px; font-size:12.5px; color:#d9e6ffc7;
      display:flex; gap:10px; align-items:center;
    }
    .topbar .dot{width:8px;height:8px;border-radius:50%;background:#ffd166}
    .topbar .sep{opacity:.35;margin:0 4px}
    .topbar a{color:#8bdcff}

    /* ==== CABECERA ==== */
    .header{display:flex;align-items:center;gap:12px;margin:14px 0 6px}
    .brand{display:flex;align-items:center;gap:12px}
    .brand img{width:44px;height:44px;border-radius:10px;box-shadow:var(--shadow)}
    .brand .t1{font-weight:800;font-size:20px;letter-spacing:.2px}
    .header .flex{flex:1}
    .btn{
      background:#1d8f5a;border:0;color:#fff;font-weight:700;
      padding:10px 14px;border-radius:10px;cursor:pointer;
      transition:.15s transform ease;
      box-shadow:var(--shadow);
    }
    .btn:active{transform:translateY(1px)}
    .subtle{color:var(--muted); font-size:12.5px}

    /* ==== CARDS/CONTENEDORES ==== */
    .grid{display:grid;grid-template-columns:1fr;gap:14px}
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:14px;
      padding:16px;
      box-shadow:var(--shadow);
    }
    .card h2{margin:0 0 10px;font-size:20px}
    .muted{color:var(--muted)}
    .row{display:grid;grid-template-columns:120px 1fr;gap:8px;margin:5px 0}
    .key{color:var(--muted)}
    .value{letter-spacing:.2px}

    /* ==== TABLA ==== */
    .table-wrap{border:1px solid var(--line);border-radius:12px;overflow:hidden}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px 12px;border-bottom:1px solid var(--line)}
    th{font-weight:700;text-align:right;color:#c6d6ee}
    th:first-child, td:first-child{text-align:left}
    tr:last-child td{border-bottom:0}

    /* ==== PILLS ==== */
    .pill{display:inline-block;font-weight:800;padding:2px 10px;border-radius:999px;font-size:12px}
    .buy{color:#1ecf74;background:rgba(30,207,116,.12);border:1px solid rgba(30,207,116,.45)}
    .sell{color:#ff6b6b;background:rgba(255,107,107,.12);border:1px solid rgba(255,107,107,.45)}

    /* ==== LIVE SHOT ==== */
    .live-shot{
      width:100%;display:block;border-radius:10px;
      border:1px solid var(--line);background:#0b0f1a;
    }

    /* ==== SOCIAL ==== */
    .social{display:flex;gap:10px;flex-wrap:wrap}
    .sbtn{
      border:1px solid var(--line);background:#16213b;color:#cfe7ff;
      padding:10px 14px;border-radius:10px;display:inline-flex;gap:8px;align-items:center;
    }

    /* ==== DETAILS (acorde√≥n) ==== */
    details.ac{border:1px solid var(--line);border-radius:14px;overflow:hidden}
    details.ac summary{
      list-style:none;cursor:pointer;padding:14px 16px;background:#101728;font-weight:800
    }
    details.ac summary::-webkit-details-marker{display:none}
    details.ac summary::before{content:"‚ñ∏  ";color:var(--muted)}
    details.ac[open] summary::before{content:"‚ñæ  "}
    .acc-body{padding:12px 16px;background:var(--card);border-top:1px solid var(--line)}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:820px){.grid-2{grid-template-columns:1fr}}

    .qr{
      border:1px dashed #2a3555;background:#0d1426;border-radius:12px;
      padding:10px;text-align:center
    }
    .qr img{max-width:180px;width:100%;height:auto;display:block;margin:10px auto 6px;border-radius:10px}
    .tag{display:inline-block;padding:2px 8px;border-radius:8px;font-weight:700;background:#1c2747;color:#bcd9ff;border:1px solid #2c3a63}

    .copy{display:flex;gap:8px}
    .copy input{
      flex:1;background:#0f1730;border:1px solid var(--line);border-radius:10px;
      color:#e8eefc;padding:10px 12px
    }

    /* ==== CONTROLES ==== */
    .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .switch{display:inline-flex;gap:8px;align-items:center}
    .switch input{accent-color:#40d1a8}

    /* ==== FOOT ==== */
    .foot{color:var(--muted);text-align:center;margin-top:16px}

    /* ==== HELPERS ==== */
    .hidden{display:none !important}
  </style>
</head>

<body>
  <!-- ====== BARRA SUPERIOR ====== -->
  <div class="topbar">
    <span class="dot"></span>
    Verifica los enlaces oficiales.
    <span class="sep">|</span>
    Verificaci√≥n: <a href="verificacion.html" target="_blank" rel="noopener">abrir</a>
    <span class="sep">|</span>
    .onion: <a href="https://dejandohuellapool.github.io/dejandohuella-landing/" target="_blank" rel="noopener">Clearnet</a> /
    <a href="http://dejandohuella*****.onion" target="_blank" rel="noopener">Onion</a>
  </div>

  <div class="wrap">
    <!-- ====== CABECERA ====== -->
    <div class="header">
      <div class="brand">
        <img src="img/logo.png" alt="logo" />
        <div class="t1">DejandoHuella Trader</div>
      </div>
      <div class="flex"></div>
      <button class="btn" onclick="window.open('https://wa.me/','_blank')">Solicitar informaci√≥n</button>
    </div>
    <div class="subtle" id="lastUpdate">√öltima actualizaci√≥n: ‚Äî</div>

    <!-- ====== CONTROLES ====== -->
    <div class="controls" style="margin:10px 0 16px">
      <button class="btn" id="btnRefresh">Actualizar ahora</button>
      <div class="switch">
        <input type="checkbox" id="autoRefresh" checked />
        <label for="autoRefresh" class="muted">Auto-refresh cada 15s</label>
      </div>
      <div class="muted">|</div>
      <div class="muted">Fuente MT4: <span class="mono">live/last.json</span>, <span class="mono">live/trades.jsonl</span>, <span class="mono">live/shots/latest.jpg</span></div>
    </div>

    <!-- ====== HISTORIAL ====== -->
    <div class="card">
      <h2>Historial reciente</h2>
      <div id="histEmpty" class="muted hidden">Sin operaciones a√∫n‚Ä¶</div>
      <div class="table-wrap" id="histWrap">
        <table id="tblHist" aria-label="Historial reciente">
          <thead>
            <tr>
              <th>Hora</th>
              <th>Par</th>
              <th>Lado</th>
              <th>Precio</th>
              <th>Lote</th>
              <th>SL</th>
              <th>TP</th>
            </tr>
          </thead>
          <tbody><!-- filas generadas por JS --></tbody>
        </table>
      </div>
    </div>

    <!-- ====== EN VIVO ====== -->
    <div class="card">
      <h2>Operaciones en vivo</h2>
      <div class="grid-2">
        <div>
          <div class="row"><div class="key">Par:</div>   <div class="value" id="liveSymbol">‚Äî</div></div>
          <div class="row"><div class="key">Lado:</div>  <div class="value" id="liveSide">‚Äî</div></div>
          <div class="row"><div class="key">Precio:</div><div class="value" id="livePrice">‚Äî</div></div>
          <div class="row"><div class="key">Lote:</div>  <div class="value" id="liveLot">‚Äî</div></div>
          <div class="row"><div class="key">SL / TP:</div>
            <div class="value"><span id="liveSL">‚Äî</span> / <span id="liveTP">‚Äî</span></div></div>
          <div class="row"><div class="key">Hora:</div>  <div class="value" id="liveTs">‚Äî</div></div>
        </div>
        <div>
          <img id="liveShot" class="live-shot" alt="Captura MT4 en vivo" src="live/shots/latest.jpg" />
        </div>
      </div>
    </div>

    <!-- ====== REDES ====== -->
    <div class="card">
      <h2>Redes oficiales</h2>
      <div class="muted">S√≠guenos para novedades y soporte:</div>
      <div class="social" style="margin-top:10px">
        <a class="sbtn" href="https://facebook.com" target="_blank" rel="noopener" aria-label="Facebook">
          <span>üåê</span> Facebook
        </a>
        <a class="sbtn" href="https://wa.me/" target="_blank" rel="noopener" aria-label="WhatsApp">
          <span>üí¨</span> WhatsApp
        </a>
      </div>
    </div>

    <!-- ====== MEDIOS DE PAGO + PLANES (con QRs) ====== -->
    <details class="ac" id="pagos-planes" open>
      <summary>üìÅ Medios de Pagos + Planes Premium ‚Äì DejandoHuella Trader</summary>
      <div class="acc-body">
        <div class="grid-2">
          <!-- QRs -->
          <div>
            <h3 style="margin:6px 0 6px">Cripto (QR / direcci√≥n)</h3>

            <div class="qr">
              <div class="tag">USDT ¬∑ BEP20</div>
              <img src="qr_bep20.png" alt="QR USDT BEP20" />
              <div class="copy">
                <input id="addrBEP20" class="mono" value="TU-DIRECCION-USDT-BEP20" readonly />
                <button class="btn" onclick="copyAddr('addrBEP20')">Copiar</button>
              </div>
            </div>

            <div class="qr" style="margin-top:10px">
              <div class="tag">USDT ¬∑ ERC20</div>
              <img src="qr_erc20.png" alt="QR USDT ERC20" />
              <div class="copy">
                <input id="addrERC20" class="mono" value="TU-DIRECCION-USDT-ERC20" readonly />
                <button class="btn" onclick="copyAddr('addrERC20')">Copiar</button>
              </div>
            </div>

            <div class="qr" style="margin-top:10px">
              <div class="tag">USDT ¬∑ TRC20</div>
              <img src="qr_trc20.png" alt="QR USDT TRC20" />
              <div class="copy">
                <input id="addrTRC20" class="mono" value="TU-DIRECCION-USDT-TRC20" readonly />
                <button class="btn" onclick="copyAddr('addrTRC20')">Copiar</button>
              </div>
            </div>

            <div class="qr" style="margin-top:10px">
              <div class="tag">USDT ¬∑ ARB1</div>
              <img src="qr_arb1.png" alt="QR USDT ARB1" />
              <div class="copy">
                <input id="addrARB1" class="mono" value="TU-DIRECCION-USDT-ARB1" readonly />
                <button class="btn" onclick="copyAddr('addrARB1')">Copiar</button>
              </div>
            </div>
          </div>

          <!-- Planes -->
          <div>
            <h3 style="margin:6px 0 6px">Planes Premium</h3>
            <ul style="margin:0 0 8px 16px">
              <li><b>B√°sico</b>: historial en tiempo real + se√±al en vivo.</li>
              <li><b>Pro</b>: todo lo del B√°sico + alertas priorizadas.</li>
              <li><b>VIP</b>: Pro + soporte 1:1 + configuraci√≥n dedicada.</li>
            </ul>

            <div class="muted" style="margin:8px 0">Para precios y activaci√≥n, cont√°ctanos por WhatsApp:</div>
            <button class="btn" onclick="window.open('https://wa.me/','_blank')">Solicitar precios</button>

            <hr style="border:none;border-top:1px solid var(--line);margin:16px 0">
            <h3 style="margin:6px 0 6px">Notas</h3>
            <ul style="margin:0 0 0 16px">
              <li>Una vez realizada la transacci√≥n, env√≠a el comprobante para acreditaci√≥n.</li>
              <li>Las direcciones pueden cambiar por seguridad; usa siempre las que ves aqu√≠.</li>
              <li>Para bancos locales o pagos alternos, solicita instrucciones en soporte.</li>
            </ul>
          </div>
        </div>
      </div>
    </details>

    <!-- ====== VERIFICACI√ìN ====== -->
    <details class="ac" style="margin-top:12px">
      <summary>üîí Verificaci√≥n oficial</summary>
      <div class="acc-body">
        <p class="muted">Comprueba dominios y enlaces en <a href="verificacion.html" target="_blank" rel="noopener">verificacion.html</a>.  
        Si recibes enlaces por fuera de nuestros dominios oficiales, no env√≠es fondos.</p>
      </div>
    </details>

    <!-- ====== FOOT ====== -->
    <div class="foot">
      ¬© 2025 DejandoHuella Trader ¬∑ <span class="muted">Atajos</span>:
      <span class="mono">R</span> refrescar, <span class="mono">A</span> auto-refresh on/off
    </div>
  </div>

  <!-- ====== SCRIPTS ====== -->
  <script>
    /* Utilidades */
    const $ = (sel,ctx=document)=>ctx.querySelector(sel);
    const fmt = n => Number(n).toLocaleString('es-PE',{maximumFractionDigits:2});
    const bust = () => Math.floor(Date.now()/1000); // cache-buster

    function setLastUpdate(ts){
      $('#lastUpdate').textContent = '√öltima actualizaci√≥n: ' + (ts ? ts.replaceAll('_',' ') : '‚Äî');
    }

    /* Copiar direcciones */
    function copyAddr(id){
      const el = $('#'+id);
      el.select(); el.setSelectionRange(0, 99999);
      try{
        navigator.clipboard.writeText(el.value);
        const original = el.value;
        el.value = '¬°Copiado!';
        setTimeout(()=>{ el.value = original; }, 900);
      }catch(e){}
    }

    /* CARGA EN VIVO */
    async function loadLive(){
      try{
        const r = await fetch('live/last.json?v='+bust(),{cache:'no-store'});
        if(!r.ok) throw new Error('HTTP '+r.status);
        const j = await r.json();

        $('#liveSymbol').textContent = j.symbol ?? '‚Äî';
        const side = (j.side||'').toUpperCase();
        $('#liveSide').innerHTML = side ? `<span class="pill ${side==='BUY'?'buy':'sell'}">${side}</span>` : '‚Äî';
        $('#livePrice').textContent = j.price ? fmt(j.price) : '‚Äî';
        $('#liveLot').textContent   = j.lot ?? '‚Äî';
        $('#liveSL').textContent    = j.sl ? fmt(j.sl) : '‚Äî';
        $('#liveTP').textContent    = j.tp ? fmt(j.tp) : '‚Äî';
        $('#liveTs').textContent    = j.ts ?? '‚Äî';
        setLastUpdate(j.ts);

        const shot = $('#liveShot');
        shot.src = 'live/shots/latest.jpg?v='+bust();
      }catch(e){
        console.error('live error:', e);
      }
    }

    /* HISTORIAL: √∫ltimas 6 l√≠neas de trades.jsonl (ordenadas desc) */
    async function loadHistory(){
      try{
        const r = await fetch('live/trades.jsonl?v='+bust(),{cache:'no-store'});
        if(!r.ok) throw new Error('HTTP '+r.status);
        const txt = await r.text();
        const lines = txt.trim().split(/\r?\n/).filter(Boolean);
        const last = lines.slice(-6).reverse();

        const tb = $('#tblHist tbody');
        tb.innerHTML = '';

        if(last.length===0){
          $('#histEmpty').classList.remove('hidden');
          $('#histWrap').classList.add('hidden');
          return;
        }else{
          $('#histEmpty').classList.add('hidden');
          $('#histWrap').classList.remove('hidden');
        }

        last.forEach(row=>{
          try{
            const j = JSON.parse(row);
            const tr = document.createElement('tr');
            const pill = (j.side||'').toUpperCase()==='BUY'
              ? `<span class="pill buy">BUY</span>` : `<span class="pill sell">SELL</span>`;
            tr.innerHTML = `
              <td>${j.ts ?? '‚Äî'}</td>
              <td>${j.symbol ?? '‚Äî'}</td>
              <td style="text-align:center">${pill}</td>
              <td>${j.price?fmt(j.price):'‚Äî'}</td>
              <td>${j.lot ?? '‚Äî'}</td>
              <td>${j.sl?fmt(j.sl):'‚Äî'}</td>
              <td>${j.tp?fmt(j.tp):'‚Äî'}</td>`;
            tb.appendChild(tr);
          }catch(_){}
        });
      }catch(e){
        console.error('history error:', e);
        $('#histEmpty').classList.remove('hidden');
        $('#histWrap').classList.add('hidden');
      }
    }

    /* CICLO */
    let timer = null;
    function tick(){
      loadLive(); loadHistory();
    }
    function startAuto(){
      stopAuto();
      timer = setInterval(tick, 15000);
    }
    function stopAuto(){
      if(timer){ clearInterval(timer); timer=null; }
    }

    // Eventos
    $('#btnRefresh').addEventListener('click', tick);
    $('#autoRefresh').addEventListener('change', e=>{
      if(e.target.checked) startAuto(); else stopAuto();
    });
    document.addEventListener('keydown', e=>{
      if(e.key==='r' || e.key==='R') tick();
      if(e.key==='a' || e.key==='A'){
        const chk = $('#autoRefresh');
        chk.checked = !chk.checked;
        chk.dispatchEvent(new Event('change'));
      }
    });

    // Init
    tick();
    startAuto();
  </script>
</body>
</html>
