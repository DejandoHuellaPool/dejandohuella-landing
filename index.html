<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>DejandoHuella Trader</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="dark">
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <link rel="icon" href="img/logo.png">
  <style>
    :root{--bg:#0b0f16;--fg:#e5e7eb;--muted:#94a3b8;--card:#121826;--border:#1f2a3a;--green:#16a34a;--red:#dc2626;--link:#60a5fa;--accent:#22c55e}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.5 system-ui,Segoe UI,Inter,Roboto}
    a{color:var(--link);text-decoration:none}
    .wrap{max-width:1100px;margin:auto;padding:24px}
    header{display:flex;gap:14px;align-items:center;margin-bottom:8px;flex-wrap:wrap}
    header img{width:64px;height:64px;border-radius:12px;border:1px solid var(--border);object-fit:cover;background:#0f1522}
    h1{font-size:32px;margin:0}
    h2{margin:0 0 10px}
    small,p,li{color:var(--muted)}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:18px;margin:18px 0}
    .cta{display:inline-block;background:linear-gradient(180deg,#2cf475,#22c55e);color:#06250f;padding:12px 18px;border-radius:12px;font-weight:700;border:0;box-shadow:0 6px 0 #14532d;user-select:none}
    .cta:active{transform:translateY(2px);box-shadow:0 3px 0 #14532d}
    .cta-row{display:flex;gap:12px;flex-wrap:wrap;margin-top:10px}
    .grid{display:grid;gap:14px}
    .grid-2{grid-template-columns:1fr 1fr}
    .row{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .tag{font-size:12px;padding:2px 8px;border:1px solid var(--border);border-radius:12px;color:var(--muted)}
    code{background:#0f1522;border:1px solid var(--border);padding:6px 8px;border-radius:10px;word-break:break-all}
    .copy{cursor:pointer;color:#b4d2ff;border:1px solid var(--border);padding:6px 10px;border-radius:10px;background:#0f1522}
    .badge{padding:2px 10px;border-radius:999px;font-weight:700;font-size:13px;display:inline-block}
    .kv{display:grid;grid-template-columns:auto 1fr;gap:6px 12px;font-size:16px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;border-bottom:1px solid var(--border)}
    th{text-align:left;color:#cbd5e1}
    .bar{background:#0f1522;border:1px solid var(--border);border-radius:12px;padding:8px 12px;margin-bottom:12px;display:flex;gap:10px;align-items:center;justify-content:space-between}
    /* Historial m√≥vil: scroll + cabecera sticky */
    #hist .card-body{overflow-x:auto;-webkit-overflow-scrolling:touch}
    #hist table{width:100%;table-layout:fixed}
    #hist thead th{position:sticky;top:0;background:#0f172a;z-index:1}
    @media (max-width:980px){.wrap{padding:18px}header img{width:56px;height:56px}h1{font-size:26px}.grid-2{grid-template-columns:1fr}.cta{width:100%}}
    /* Control de refresco ultra-compacto */
    #refresh-ctrl{position:fixed;top:8px;left:8px;z-index:9999;display:flex;gap:4px;transform:scale(.7);transform-origin:top left;opacity:.85}
    #refresh-ctrl button,#refresh-ctrl label{padding:2px 6px;font-size:10px;border-radius:8px}
    #refresh-ctrl button{background:#22c55e;color:#081b0f;border:0;box-shadow:0 2px 0 #14532d}
    /* Bot√≥n cerrar (X) peque√±o en el banner */
    .btn-close{font-size:12px;line-height:1;padding:2px 6px;border-radius:8px;background:#22c55e;color:#081b0f;border:0}
  </style>
</head>
<body>
  <!-- Control de refresco -->
  <div id="refresh-ctrl">
    <button id="btn-hard-reload">Actualizar ahora</button>
    <label><input id="chk-auto" type="checkbox"> Auto 5s</label>
  </div>

  <!-- Banner superior -->
  <div class="bar" id="site-alert">
    <span>‚ö†Ô∏è Verifica los enlaces oficiales. Usa nuestra <a href="verificacion.html">Verificaci√≥n oficial</a> o la direcci√≥n .onion.</span>
    <button class="btn-close" data-alert-close>√ó</button>
  </div>

  <div class="wrap">
    <header>
      <img src="img/logo.png" alt="DejandoHuella logo" loading="lazy" decoding="async">
      <div>
        <h1>DejandoHuella Trader</h1>
        <div class="cta-row">
          <a class="cta" href="whatsapp.html">Solicitar informaci√≥n</a>
        </div>
      </div>
    </header>

    <p><small>√öltima actualizaci√≥n: <span id="lu"></span></small></p>

    <!-- Historial -->
    <section id="hist" class="card">
      <h2>Historial reciente</h2>
      <div id="hist-empty" class="meta">Sin operaciones a√∫n‚Ä¶</div>
      <div class="card-body">
        <table id="hist-table" style="display:none">
          <thead>
            <tr>
              <th>Hora</th><th>Par</th><th>Lado</th>
              <th style="text-align:right">Precio</th><th style="text-align:right">Lote</th>
              <th style="text-align:right">SL</th><th style="text-align:right">TP</th>
            </tr>
          </thead>
          <tbody id="hist-body"></tbody>
        </table>
      </div>
    </section>

    <!-- En vivo -->
    <section id="en-vivo" class="card">
      <h2>Operaciones en vivo</h2>
      <div class="kv">
        <strong>Par:</strong><span id="lv-symbol">‚Äî</span>
        <strong>Lado:</strong><span id="lv-side">‚Äî</span>
        <strong>Precio:</strong><span id="lv-price">‚Äî</span>
        <strong>Lote:</strong><span id="lv-lots">‚Äî</span>
        <strong>SL / TP:</strong><span id="lv-sltp">‚Äî</span>
        <strong>Hora:</strong><span id="lv-ts">‚Äî</span>
      </div>
      <div style="margin-top:10px">
        <img id="lv-shot" src="" alt="Captura MT4 en vivo"
             style="width:100%;max-width:960px;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,.2)">
      </div>
    </section>

    <!-- Redes -->
    <section class="card" id="redes">
      <h2>Redes oficiales</h2>
      <p>S√≠guenos para novedades y soporte:</p>
      <div class="cta-row">
        <a class="cta" href="https://www.facebook.com/share/1J54upxdPb/" target="_blank" rel="noopener">Facebook</a>
        <a class="cta" href="whatsapp.html" target="_blank" rel="noopener">WhatsApp</a>
      </div>
    </section>

    <!-- Pagos + Planes (plegable) -->
    <section id="medios-pago" class="card">
      <details>
        <summary style="cursor:pointer;font-weight:800;font-size:1.05rem;">üí≥ Medios de Pagos + Planes Premium ‚ÄìDejandoHuella Trader</summary>
        <div style="margin-top:12px">
          <div class="card">
            <h2>Pagos (verifica la red)</h2>
            <div class="grid grid-2">
              <div>
                <div class="row"><b>BTC</b><span class="tag">Bitcoin</span></div>
                <div class="row">
                  <code id="btc">bc1qu6c2036ehv2rssqv32mzv5z9tf92px6q8wp0f4</code>
                  <span class="copy" onclick="copyTxt('btc')">Copiar</span>
                </div>
                <div class="row"><b>USDT</b><span class="tag">TRC20 / Tron</span></div>
                <div class="row">
                  <code id="trc20">TCoqxfkqA4MAmTbqtWnCzwBzQToecwSiHd</code>
                  <span class="copy" onclick="copyTxt('trc20')">Copiar</span>
                </div>
                <div class="row"><b>USDT</b><span class="tag">BEP20 / BSC</span></div>
                <div class="row">
                  <code id="bep20">0xa721CD06Fce89aAD41e7f8eC6604653712B7c22F</code>
                  <span class="copy" onclick="copyTxt('bep20')">Copiar</span>
                </div>
              </div>
              <div>
                <div class="row"><b>USDT</b><span class="tag">Arbitrum One</span></div>
                <div class="row">
                  <code id="arb1">0xa721CD06Fce89aAD41e7f8eC6604653712B7c22F</code>
                  <span class="copy" onclick="copyTxt('arb1')">Copiar</span>
                </div>
                <div class="row"><b>USDT</b><span class="tag">ERC-20 / Ethereum</span></div>
                <div class="row">
                  <code id="erc20">0xa721CD06Fce89aAD41e7f8eC6604653712B7c22F</code>
                  <span class="copy" onclick="copyTxt('erc20')">Copiar</span>
                </div>
              </div>
            </div>
            <hr style="border-color:var(--border);opacity:.5;margin:18px 0">
            <div class="row">
              <b>Transferencia bancaria (USD)</b><span class="tag">Banco Pichincha</span>
            </div>
            <p style="margin:6px 0 10px">
              <b>Titular:</b> Empresa DejandoHuella<br>
              <b>Banco:</b> Pichincha<br>
              <b>Tipo de cuenta:</b> Ahorros / Corriente<br>
              <b>N√∫mero de cuenta:</b> <code id="cta-pich">2207922413</code> <span class="copy" onclick="copyTxt('cta-pich')">Copiar</span><br>
              <b>Referencia:</b> ‚ÄúDejandoHuella + tu nombre‚Äù
            </p>
            <div style="display:flex;gap:10px;align-items:center">
              <img src="img/qr-pichincha.png" alt="QR Banco Pichincha" width="160" height="160" style="border:1px solid var(--border);border-radius:10px;background:#fff">
              <small>Descargar: <a class="cta" href="img/qr-pichincha.png" download="qr-pichincha.png">PNG</a></small>
            </div>
          </div>

          <div class="card">
            <h2>Planes Premium ‚Äì DejandoHuella Trader</h2>
            <ul>
              <li>‚úÖ Se√±ales Premium (BTC/USD)</li>
              <li>‚úÖ EA MT4 con licencia y soporte</li>
              <li>‚úÖ Mentor√≠a y transparencia</li>
            </ul>
          </div>
        </div>
      </details>
    </section>

    <!-- Contacto -->
    <section class="card" id="contacto">
      <h2>Contacto</h2>
      <p><a class="cta" href="mailto:dejandohuella_pool@proton.me">Escr√≠benos a ProtonMail</a></p>
      <p>.onion: <b>xsfd6o4hs4lffweef6jnfkfvyhmnldi5ng7zjccev2kouh5grsvvh4yd.onion</b></p>
    </section>

    <footer class="card">
      <p>Clearnet: <a href="./">Abrir sitio</a> | .onion: <code>xsfd6o4hs4lffweef6jnfkfvyhmnldi5ng7zjccev2kouh5grsvvh4yd.onion</code></p>
      <p>Contacto: <a href="mailto:dejandohuella_pool@proton.me">dejandohuella_pool@proton.me</a></p>
      <small style="color:#94a3b8">¬© 2025 DejandoHuella Trader</small>
    </footer>
  </div>

  <!-- ====== LIVE_BASE (para GitHub Pages) ======
       Si est√°s en la .onion o en tu Nginx local, d√©jalo vac√≠o ''.
       Para GitHub Pages, pon HTTPS de tu tunnel/vps, e.g. 'https://live.dejandohuella.site' -->
  <script>
    window.LIVE_BASE = ''; // <-- para GitHub Pages: 'https://live.TU-DOMINIO'
    function liveUrl(p){ var b=(window.LIVE_BASE||'').replace(/\/$/,''); return b + p; }
  </script>

  <script>
    // Fecha
    document.getElementById('lu').textContent = new Date().toISOString().slice(0,10);

    // Cerrar banner
    document.querySelector('[data-alert-close]')?.addEventListener('click',()=>{
      const b=document.getElementById('site-alert'); if(b) b.remove();
    });

    // Copiar
    function copyTxt(id){
      const el=document.getElementById(id); if(!el) return;
      const txt=el.textContent.trim();
      if(navigator.clipboard && window.isSecureContext){ navigator.clipboard.writeText(txt); }
      else{ const ta=document.createElement('textarea'); ta.value=txt; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove(); }
    }

    // Helpers num√©ricos
    const nice=(n,dp)=> (n==null||n==='')?'‚Äî':(dp==null?Number(n):Number(n).toFixed(dp));
    const badge=s=>`<span class="badge" style="background:${(s||'').toUpperCase().includes('BUY')?'#16a34a22':'#dc262622'};color:${(s||'').toUpperCase().includes('BUY')?'#16a34a':'#dc2626'}">${(s||'‚Äî').toUpperCase()}</span>`;
    const localTs=ts=>{ if(!ts) return '‚Äî'; const d=new Date(ts.replace(/\./g,'-').replace(' ','T')); return isNaN(+d)?ts:d.toLocaleString(); };

    // Imagen en vivo
    (function(){
      const img=document.getElementById('lv-shot');
      function set(){ img.src = liveUrl('/live/shots/latest.jpg') + '?ts=' + Date.now(); }
      set(); setInterval(set, 2500);
    })();

    // √öltimo evento
    async function pollLast(){
      try{
        const r=await fetch(liveUrl('/live/last.json')+'?ts='+Date.now(),{cache:'no-store'});
        const txt=await r.text();
        const a=txt.indexOf('{'), b=txt.lastIndexOf('}'); const clean=(a>=0&&b>=0)?txt.slice(a,b+1):txt;
        const d=JSON.parse(clean);
        document.getElementById('lv-symbol').textContent=d.symbol||'‚Äî';
        document.getElementById('lv-side').innerHTML=badge(d.side);
        document.getElementById('lv-price').textContent=nice(d.price);
        document.getElementById('lv-lots').textContent=nice(d.lots,2);
        document.getElementById('lv-sltp').textContent=`${nice(d.sl)} / ${nice(d.tp)}`;
        document.getElementById('lv-ts').textContent=localTs(d.ts);
      }catch(_){}
      setTimeout(pollLast,2500);
    }
    pollLast();

    // Historial
    async function pollHist(){
      const tbl=document.getElementById('hist-table'), body=document.getElementById('hist-body'), empty=document.getElementById('hist-empty');
      function render(rows){
        if(!rows.length){ tbl.style.display='none'; empty.style.display='block'; return; }
        empty.style.display='none'; tbl.style.display='table';
        body.innerHTML=rows.map(r=>`<tr>
            <td>${localTs(r.ts)}</td>
            <td>${r.symbol||'‚Äî'}</td>
            <td>${badge(r.side)}</td>
            <td style="text-align:right">${nice(r.price)}</td>
            <td style="text-align:right">${nice(r.lots,2)}</td>
            <td style="text-align:right">${nice(r.sl)}</td>
            <td style="text-align:right">${nice(r.tp)}</td>
          </tr>`).join('');
      }
      try{
        const r=await fetch(liveUrl('/live/trades.jsonl')+'?ts='+Date.now(),{cache:'no-store'});
        if(!r.ok){ render([]); return; }
        const txt=await r.text();
        const lines=(txt||'').trim().split(/\r?\n/).filter(Boolean);
        const objs=lines.slice(-10).map(l=>{try{return JSON.parse(l);}catch(_){return null;}}).filter(Boolean).reverse();
        render(objs);
      }catch(_){ render([]); }
      setTimeout(pollHist,5000);
    }
    pollHist();

    // Recarga completa y auto 5s
    (function(){
      const btn=document.getElementById('btn-hard-reload');
      const chk=document.getElementById('chk-auto'); let t=null;
      function start(){ stop(); t=setInterval(()=>location.reload(),5000); }
      function stop(){ if(t){clearInterval(t); t=null;} }
      btn?.addEventListener('click',()=>{ const u=new URL(location.href); u.searchParams.set('ts',Date.now()); location.replace(u.toString()); });
      chk?.addEventListener('change',()=>{ chk.checked?start():stop(); try{localStorage.setItem('dh_auto_reload_5s',chk.checked?'1':'');}catch(_){}});
      try{ if(localStorage.getItem('dh_auto_reload_5s')==='1'){ chk.checked=true; start(); } }catch(_){}
    })();
  </script>
</body>
</html>
